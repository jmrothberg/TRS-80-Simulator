10 REM JMR'S BASIC SPACE INVADERS AUG 20 2024
20 REM RUNS ON TRS-80 MODEL 1 SIMULATOR
100 REM INITIALIZE VARIABLES
110 LET S = 120
120 DIM B(5)  : REM ARRAY FOR 5 BULLETS
125 DIM EB(5) : REM ARRAY FOR 5 ENEMY BULLETS
130 DIM E(15)
135 DIM BK(60) : REM ARRAY FOR 4 BUNKERS WITH 15 PIXELS EACH
140 LET D = 1
150 LET SC = 0
160 LET LV = 3    
170 LET SP = 20
180 LET F = 2 : REM HOW FAST PLAYER PLAYS
190 LET L = 1 : REM HOW FAST BULLETS MOVES 

200 REM INITIALIZE ENEMIES
210 FOR I = 1 TO 15
220 LET R = INT((I-1)/ 5) 
230 LET C = I - 1 - (R * 5)
240 LET E(I) =  R * 1024 + (C * 24) + 1
250 NEXT I

260 REM INITIALIZE BUNKERS
270 FOR I = 1 TO 60
280 LET BK(I) = 1
290 NEXT I

300 REM MAIN GAME LOOP
310 GOSUB 1000
320 GOSUB 2000 : REM CHECK INPUTS
330 GOSUB 3000
340 GOSUB 4000
350 FOR I = 1 TO SP
360 NEXT I
370 GOTO 300

1000 REM DRAW SCREEN
1010 CLS
1020 PRINT "SCORE:"; SC; " LIVES:"; LV
1030 FOR I = 1 TO 15
1040 IF E(I) > 0 THEN GOSUB 1500 : REM DRAW ENEMIES
1050 NEXT I
1060 GOSUB 1600 : REM DRAW GUN
1070 FOR I = 1 TO 5  : REM DRAW ALL ACTIVE BULLETS
1080 IF B(I) > 0 THEN GOSUB 1700 : REM DRAW PLAYER BULLET
1090 NEXT I
1095 FOR I = 1 TO 5  : REM DRAW ALL ACTIVE ENEMY BULLETS
1096 IF EB(I) > 0 THEN GOSUB 1750 : REM DRAW ENEMY BULLETS
1097 NEXT I
1098 GOSUB 1800 : REM DRAW BUNKERS
1100 RETURN

1500 REM DRAW SPACE INVADER ENEMY
1510 LET X = E(I) MOD 128
1520 LET Y = INT(E(I) / 128)
1530 REM TOP ROW
1540 SET(X+1,Y): SET(X+4,Y)
1550 REM SECOND ROW
1560 SET(X+2,Y+1): SET(X+3,Y+1)
1570 REM THIRD ROW
1580 SET(X,Y+2): SET(X+1,Y+2): SET(X+2,Y+2): SET(X+3,Y+2): SET(X+4,Y+2): SET(X+5,Y+2)
1590 REM FOURTH ROW
1600 SET(X,Y+3): SET(X+1,Y+3): SET(X+2,Y+3): SET(X+3,Y+3): SET(X+4,Y+3): SET(X+5,Y+3)
1610 REM FIFTH ROW
1620 SET(X,Y+3): SET(X+2,Y+4): SET(X+3,Y+4): SET(X+5,Y+4)
1630 REM BOTTOM ROW
1640 SET(X+1,Y+5): SET(X+4,Y+5)
1650 RETURN

1600 REM DRAW GUN
1610 SET(S, 48)
1620 SET(S-1, 48)
1630 SET(S+1, 48)
1640 SET(S, 47)
1650 RETURN

1700 REM DRAW SINGLE BULLET
1710 LET BX = B(I) MOD 128
1720 LET BY = INT(B(I) / 128)
1730 SET(BX, BY)
1740 RETURN

1750 REM DRAW SINGLE ENEMY BULLET
1760 LET EBX = EB(I) MOD 128
1770 LET EBY = INT(EB(I) / 128)
1780 SET(EBX, EBY)
1790 RETURN

1800 REM DRAW BUNKERS
1810 FOR I = 1 TO 4
1820 FOR J = 1 TO 5
1830 IF BK((I-1)*15+J) = 1 THEN SET(J+28+(I-1)*24, 45)
1840 NEXT J
1850 FOR J = 6 TO 10
1860 IF BK((I-1)*15+J) = 1 THEN SET(J+23+(I-1)*24, 44)
1870 NEXT J
1880 FOR J = 11 TO 15
1890 IF BK((I-1)*15+J) = 1 THEN SET(J+18+(I-1)*24, 43)
1900 NEXT J
1910 NEXT I
1920 RETURN
 
2000 REM CHECK INPUT
2010 LET K = PEEK(14400)
2015 REM PRINT@100, "KEY IS",K
2020 IF K = 65 THEN GOSUB 2100
2030 IF K = 83 THEN GOSUB 2200
2040 IF K = 32 THEN GOSUB 2300
2050 RETURN

2100 REM MOVE LEFT
2110 IF S > 1 THEN LET S = S - F
2120 RETURN

2200 REM MOVE RIGHT
2210 IF S < 126 THEN LET S = S + F
2220 RETURN

2300 REM FIRE BULLET
2310 FOR I = 1 TO 5  : REM FIND FIRST AVAILABLE BULLET SLOT
2320 IF B(I) = 0 THEN LET B(I) = S + 45 * 128 
2325 IF B(I) = S + 45 * 128 THEN RETURN
2330 NEXT I
2340 RETURN

3000 REM UPDATE GAME STATE
3010 FOR I = 1 TO 5  : REM UPDATE PLAYER BULLETS
3020 IF B(I) > 0 THEN LET B(I) = B(I) - 128 * L
3030 IF B(I) < 0 THEN LET B(I) = 0
3040 NEXT I
3050 FOR I = 1 TO 15
3060 IF E(I) > 0 THEN LET E(I) = E(I) + D
3070 IF E(I) > 0 THEN GOSUB 3100 : REM CHECK ENEMY BOUNDARIES
3080 NEXT I
3085 FOR I = 1 TO 5  : REM UPDATE ALL ENEMY BULLETS
3086 IF EB(I) > 0 THEN LET EB(I) = EB(I) + 128 * L
3087 IF EB(I) > 6144 THEN LET EB(I) = 0
3088 NEXT I
3090 GOSUB 3300 : REM ENEMY SHOOTS
3095 RETURN

3100 REM CHECK ENEMY BOUNDARIES
3110 IF E(I) MOD 128 = 0 OR E(I) MOD 128 = 127 THEN GOSUB 3200
3120 RETURN

3200 REM REVERSE DIRECTION AND MOVE DOWN
3210 LET D = -D
3220 GOSUB 3500
3230 RETURN

3300 REM ENEMY SHOOTS
3310 IF RND > 0.95 THEN GOTO 3320 ELSE RETURN
3320 LET R = INT(RND(16))
3330 IF E(R) = 0 THEN RETURN : REM IF NO ENEMY
3340 FOR I = 1 TO 5
3350 IF EB(I) = 0 THEN LET EB(I) = E(R) + 128
3355 IF EB(I) = E(R) + 128 THEN RETURN
3360 NEXT I
3370 RETURN

3500 REM MOVE ENEMIES DOWN
3510 FOR J = 1 TO 15
3520 IF E(J) > 0 THEN LET E(J) = E(J) + 256
3530 NEXT J
3540 RETURN

4000 REM CHECK HITS
4010 FOR I = 1 TO 15
4020 FOR J = 1 TO 5  : REM CHECK ALL BULLETS FOR COLLISION
4030 IF B(J) > 0 AND E(I) > 0 THEN GOSUB 4100 : REM CHECK BULLET HIT
4040 NEXT J
4050 IF E(I) > 5888 THEN GOSUB 6000
4060 NEXT I
4070 GOSUB 4200 : REM CHECK BUNKER HITS
4080 GOSUB 4500 : REM CHECK PLAYER HIT
4090 RETURN

4100 REM CHECK BULLET HIT
4110 LET BX = B(J) MOD 128
4120 LET BY = INT(B(J) / 128)
4130 LET EX = E(I) MOD 128
4140 LET EY = INT(E(I) / 128)
4150 IF BX >= EX AND BX < EX+6 AND BY >= EY AND BY < EY+6 THEN GOSUB 5000
4160 RETURN

4200 REM CHECK BUNKER HITS
4210 FOR I = 1 TO 60
4220 IF BK(I) = 1 THEN GOSUB 4300
4230 NEXT I
4240 RETURN

4300 REM CHECK BULLET HIT BUNKER
4310 LET BN = INT((I-1)/15) +1 :REM STARTING AT 1
4320 LET BP = (I-1) MOD 15 + 1
4330 IF BP <= 5 THEN LET BX = BP+28+(BN-1)*24
4335 IF BP > 5 AND BP <= 10 THEN LET BX = BP+23+(BN-1)*24
4336 IF BP > 10 THEN LET BX = BP+18+(BN-1)*24
4340 LET BY = 44 - INT((BP-1)/5) 
4350 FOR K = 1 TO 5 
4360 IF B(K) > 0 THEN GOSUB 4400  
4370 IF EB(K) > 0 THEN GOSUB 4450  
4380 NEXT K
4390 RETURN

4400 REM PLAYER BULLET HIT BUNKER
4410 LET BBX = B(K) MOD 128  
4420 LET BBY = INT(B(K) / 128)  
4430 IF BBX = BX AND BBY = BY THEN LET BK(I) = 0
4435 IF BBX = BX AND BBY = BY THEN LET B(K) = 0  
4440 RETURN

4450 REM ENEMY BULLET HIT BUNKER
4460 LET EBX = EB(K) MOD 128  
4470 LET EBY = INT(EB(K) / 128)  
4480 IF EBX = BX AND EBY = BY THEN LET BK(I) = 0 
4485 IF EBX = BX AND EBY = BY THEN LET EB(K) = 0  
4490 RETURN

4500 REM CHECK PLAYER HIT
4510 FOR I = 1 TO 5
4520 IF EB(I) > 0 THEN GOSUB 4550
4530 NEXT I
4540 RETURN

4550 REM CHECK SINGLE ENEMY BULLET
4560 LET EBX = EB(I) MOD 128
4570 LET EBY = INT(EB(I) / 128)
4580 IF EBY = 47 AND ABS(EBX - S) <= 1 THEN GOSUB 6000
4590 RETURN

5000 REM HIT ENEMY
5010 LET SC = SC + 10
5020 LET E(I) = 0
5030 LET B(J) = 0  : REM RESET THE BULLET THAT HIT
5040 REM GOSUB 5100 REM NO DELAYS
5050 GOSUB 5200
5060 RETURN

5100 REM INCREASE SPEED
5110 IF SP > 5 THEN GOSUB 5150
5120 RETURN

5150 REM DECREASE DELAY
5160 LET T = SC / 100
5170 LET T = T - INT(T)
5180 IF T = 0 THEN LET SP = SP - 1
5190 RETURN

5200 REM CHECK IF ALL ENEMIES DESTROYED
5210 LET C = 0
5220 FOR J = 1 TO 15
5230 IF E(J) > 0 THEN LET C = C + 1
5240 NEXT J
5250 IF C = 0 THEN GOSUB 7000
5260 RETURN

6000 REM PLAYER INVADED OR HIT
6010 LET LV = LV - 1
6020 IF LV = 0 THEN GOTO 8000
6030 FOR I = 1 TO 15
6040 LET E(I) = 0
6050 NEXT I
6060 FOR I = 1 TO 5
6070 LET EB(I) = 0
6080 NEXT I
6090 LET S = 120
6100 GOSUB 7000
6110 RETURN

7000 REM RESPAWN ENEMIES
7010 FOR I = 1 TO 15
7020 LET R = INT((I-1)/ 5)
7030 LET C = I - 1 - (R * 5)
7040 LET E(I) =  R * 1024 + (C * 24) + 1
7050 NEXT I
7060 RETURN

8000 REM GAME OVER
8010 CLS
8020 PRINT "GAME OVER"
8030 PRINT "FINAL SCORE:"; SC
8040 PRINT "PRESS ANY KEY TO RESTART"
8050 IF PEEK(14400) = 0 THEN GOTO 8050
8060 GOTO 100















































































































































































































































































































